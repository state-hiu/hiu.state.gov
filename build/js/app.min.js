function onEachFeatureLargeLabels(e,a){e.properties&&e.properties.NAME&&("Y"==e.properties.Italics?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-large-country-italics-label",offset:[0,0],direction:"center",pane:"labels"}):a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-large-country-label",offset:[0,0],direction:"center",pane:"labels"}))}function onEachFeatureMediumLabels(e,a){e.properties&&e.properties.NAME&&("Y"==e.properties.Italics?"right"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-medium-country-italics-label",offset:[0,0],direction:"right",pane:"labels"}):"left"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-medium-country-italics-label",offset:[0,0],direction:"left",pane:"labels"}):"top"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-medium-country-italics-label",offset:[0,0],direction:"top",pane:"labels"}):"bottom"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-medium-country-italics-label",offset:[0,0],direction:"bottom",pane:"labels"}):a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-medium-country-italics-label",offset:[0,0],direction:"center",pane:"labels"}):"right"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-medium-country-label",offset:[0,0],direction:"right",pane:"labels"}):"left"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-medium-country-label",offset:[0,0],direction:"left",pane:"labels"}):"top"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-medium-country-label",offset:[0,0],direction:"top",pane:"labels"}):"bottom"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-medium-country-label",offset:[0,0],direction:"bottom",pane:"labels"}):a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-medium-country-label",offset:[0,0],direction:"center",pane:"labels"}))}function onEachFeatureSmallLabels(e,a){e.properties&&e.properties.NAME&&("Y"==e.properties.Italics?"right"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-small-country-italics-label",offset:[0,0],direction:"right",pane:"labels"}):"left"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-small-country-italics-label",offset:[0,0],direction:"left",pane:"labels"}):"top"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-small-country-italics-label",offset:[0,0],direction:"top",pane:"labels"}):"bottom"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-small-country-italics-label",offset:[0,0],direction:"bottom",pane:"labels"}):a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-small-country-italics-label",offset:[0,0],direction:"center",pane:"labels"}):"right"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-small-country-label",offset:[0,0],direction:"right",pane:"labels"}):"left"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-small-country-label",offset:[0,0],direction:"left",pane:"labels"}):"top"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-small-country-label",offset:[0,0],direction:"top",pane:"labels"}):"bottom"==e.properties.direction?a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-small-country-label",offset:[0,0],direction:"bottom",pane:"labels"}):a.bindTooltip(e.properties.NAME,{permanent:!0,className:"my-small-country-label",offset:[0,0],direction:"center",pane:"labels"}))}function onEachFeatureRegions(e,a){e.properties&&e.properties.REGION_NA&&a.bindTooltip(e.properties.REGION_NA,{permanent:!0,className:"my-region-label",offset:[0,0],direction:"center",pane:"labels"})}function addTopoData(){var e=function(e){topoData=e,topoLayer=new L.TopoJSON(topoData),topoLayer.addTo(map),topoLayer.eachLayer(handleLayer)};void 0!=window.topoData?e(topoData):$.getJSON("assets/data/bureau_outline_topojson5.json").done(e)}function handleLayer(e){var a;switch(e.feature.properties.RegBureau){case"AF":a="#0A2E52";break;case"EAP":a="#0A2E52";break;case"EUR":a="#0A2E52";break;case"NEA":a="#0A2E52";break;case"SCA":a="#0A2E52";break;case"WHA":a="#0A2E52";break;default:a="#b3b3b3"}e.setStyle({fillColor:a,fillOpacity:0,color:a,weight:0,opacity:0}),e.on({mouseover:enterLayer,mouseout:leaveLayer,click:clickLayer})}function enterLayer(){if(1==leftLayer){switch(this.bringToFront(),this.feature.properties.RegBureau){case"AF":fillColor="#fc944f";break;case"EAP":fillColor="#fced8d";break;case"EUR":fillColor="#eeb3cb";break;case"NEA":fillColor="#b8d773";break;case"SCA":fillColor="#b5aed6";break;case"WHA":fillColor="#a8c8e9";break;default:fillColor="#b3b3b3"}this.setStyle({fillColor:fillColor,fillOpacity:.5,color:fillColor,weight:0,opacity:0}),leftLayer=!1}}function leaveLayer(){switch(this.feature.properties.RegBureau){case"USA":fillColor="#b3b3b3";break;default:fillColor="#0A2E52"}this.bringToBack(),this.setStyle({fillColor:fillColor,fillOpacity:0,color:fillColor,weight:0,opacity:0}),leftLayer=!0}function getProducts(e,a,r){L.featureGroup();$.ajax({dataType:"json",url:"products/products.json",success:function(t){var o=L.geoJson(t,{zIndex:100,onEachFeature:function(e,a){}});$(".product-listings").empty(),1==firstClick&&(map.addControl(new L.Control.ListMarkers({layer:o})),firstClick=!1),window.map.flyTo(a,r);var n=function(e){e.layer;selectedID=e.layer._leaflet_id,$(".item").removeClass("active"),$('.item[id="item-'+selectedID+'"]').addClass("active");var a=$('.item[id="item-'+selectedID+'"]').parent().attr("class");$("."+a).prepend($('.item[id="item-'+selectedID+'"]'))};switch(e){case"AF":map.removeLayer(EAPmarkers),map.removeLayer(EURmarkers),map.removeLayer(NEAmarkers),map.removeLayer(SCAmarkers),map.removeLayer(WHAmarkers),map.removeLayer(newProducts),map.addLayer(AFmarkers),AFmarkers.on("popupopen",function(e){n(e)}),AFcount++;break;case"EAP":map.removeLayer(AFmarkers),map.removeLayer(EURmarkers),map.removeLayer(NEAmarkers),map.removeLayer(SCAmarkers),map.removeLayer(WHAmarkers),map.removeLayer(newProducts),map.addLayer(EAPmarkers),EAPmarkers.on("click",function(e){n(e)}),EAPcount++;break;case"EUR":map.removeLayer(AFmarkers),map.removeLayer(EAPmarkers),map.removeLayer(NEAmarkers),map.removeLayer(SCAmarkers),map.removeLayer(WHAmarkers),map.removeLayer(newProducts),map.addLayer(EURmarkers),EURmarkers.on("click",function(e){n(e)}),EURcount++;break;case"NEA":map.removeLayer(AFmarkers),map.removeLayer(EAPmarkers),map.removeLayer(EURmarkers),map.removeLayer(SCAmarkers),map.removeLayer(WHAmarkers),map.removeLayer(newProducts),map.addLayer(NEAmarkers),NEAmarkers.on("click",function(e){n(e)}),NEAcount++;break;case"SCA":map.removeLayer(AFmarkers),map.removeLayer(EAPmarkers),map.removeLayer(EURmarkers),map.removeLayer(NEAmarkers),map.removeLayer(WHAmarkers),map.removeLayer(newProducts),map.addLayer(SCAmarkers),SCAmarkers.on("popupopen",function(e){n(e)}),SCAcount++;break;case"WHA":map.removeLayer(AFmarkers),map.removeLayer(EAPmarkers),map.removeLayer(EURmarkers),map.removeLayer(NEAmarkers),map.removeLayer(SCAmarkers),map.removeLayer(newProducts),map.addLayer(WHAmarkers),WHAmarkers.on("click",function(e){n(e)}),WHAcount++}}})}function clickTab(e){var a,r;switch(map.closePopup(),map.removeLayer(AFmarkers),map.removeLayer(EAPmarkers),map.removeLayer(EURmarkers),map.removeLayer(NEAmarkers),map.removeLayer(SCAmarkers),map.removeLayer(WHAmarkers),e){case"AF":a=[-1,-3],r=4,activeLayer="AF";break;case"EAP":a=[25,85],r=4,activeLayer="EAP";break;case"EUR":a=[51,22],r=4,activeLayer="EUR";break;case"NEA":a=[28,3],r=4,activeLayer="NEA";break;case"SCA":a=[35,52.5],r=4,activeLayer="SCA";break;case"WHA":a=[5,-72],r=4,activeLayer="WHA";break;case"global":a=[20,25],r=3,activeLayer="global";break;default:a=[14,-20],r=3}getProducts(e,a,r),$(".sidebar").addClass("sidebar-tall"),"home"==e&&($(".sidebar").removeClass("sidebar-tall"),map.addLayer(newProducts)),layerClicked=!0}function clickLayer(e){var a,r,t=!0;switch(this.feature.properties.RegBureau){case"AF":a=[-1,-3],r=4,activeLayer="AF",sidebar.open("AF");break;case"EAP":a=[25,85],r=4,activeLayer="EAP",sidebar.open("EAP");break;case"EUR":a=[51,22],r=4,activeLayer="EUR",sidebar.open("EUR");break;case"NEA":a=[28,3],r=4,activeLayer="NEA",sidebar.open("NEA");break;case"SCA":a=[35,52.5],r=4,activeLayer="SCA",sidebar.open("SCA");break;case"WHA":a=[5,-72],r=4,activeLayer="WHA",sidebar.open("WHA");break;case"USA":t=!1;break;default:a=[14,-20],r=3}if(0==t)return void console.log("continueFunction is false, exiting function");getProducts(this.feature.properties.RegBureau,a,r),$(".sidebar").addClass("sidebar-tall"),layerClicked=!0}var goToProduct=function(e){var a=document.location.hash;e&&(a=e.getAttribute("href"),ga("send","event",{eventCategory:"product",eventAction:"click new product pin - preview",eventLabel:a,transport:"beacon"})),a&&(a=a.slice(1).split(","),region_hash=a[0].replace(",",""),1==a.length?document.getElementById(region_hash).click():a.length>1&&(product_hash=a[1].replace("#",""),document.getElementById(region_hash).click(),setTimeout(function(){document.getElementById("modal#"+region_hash+","+product_hash).click(),$('description-image.a[href="#'+region_hash+","+product_hash+'"]').trigger("click"),document.location.hash="#"+region_hash+","+product_hash,ga("send","event",{eventCategory:"product",eventAction:"link - preview",eventLabel:document.location.hash,transport:"beacon"})},1500)))},addButtons=function(e,a,r,t){return e==a?($(".close").after('<button type="button" class="btn btn-default btn-next" style="float: right;margin-right: 5px;">Next Page</button><button type="button" class="btn btn-default btn-prev" style="float: right;margin-right: 5px;">Prev Page</button>'),$(".modal-footer").prepend('<button type="button" class="btn btn-default btn-prev">Prev Page</button><button type="button" class="btn btn-default btn-next">Next Page</button>'),$(".btn-next").prop("disabled",!0),$(".modal-header .btn-prev").after('<span class="modal-header-text" style="float: right;margin-right: 8px;margin-top: 8px;">Page '+(e-1)+" of "+(a-1)+"</span>"),$(".modal-footer .btn-prev").before('<span class="modal-footer-text" style="margin-right: 8px;margin-top: 8px;">Page '+(e-1)+" of "+(a-1)+"</span>"),$(".btn-prev").on("click",function(){console.log("activate prev button only"),console.log("jpegDisplayNumber valx1"),console.log(e),e--,console.log("jpegDisplayNumber valx2"),console.log(e),console.log("dropdown val"),console.log($(r).find("li")),t.find("#modal-img").attr("src",$(r).find("li").eq(e-1).find("a").attr("href")),$(".btn-prev,.btn-next").remove(),$(".modal-header-text,.modal-footer-text").remove(),addButtons(e,a,r,t)}),"final page"):e-1==1?($(".close").after('<button type="button" class="btn btn-default btn-next" style="float: right;margin-right: 5px;">Next Page</button><button type="button" class="btn btn-default btn-prev" style="float: right;margin-right: 5px;">Prev Page</button>'),$(".modal-footer").prepend('<button type="button" class="btn btn-default btn-prev">Prev Page</button><button type="button" class="btn btn-default btn-next">Next Page</button>'),$(".btn-prev").prop("disabled",!0),$(".modal-header .btn-prev").after('<span class="modal-header-text" style="float: right;margin-right: 8px;margin-top: 8px;">Page '+(e-1)+" of "+(a-1)+"</span>"),$(".modal-footer .btn-prev").before('<span class="modal-footer-text" style="margin-right: 8px;margin-top: 8px;">Page '+(e-1)+" of "+(a-1)+"</span>"),$(".btn-next").on("click",function(){e++,t.find("#modal-img").attr("src",$(r).find("li").eq(e-1).find("a").attr("href")),$(".btn-prev,.btn-next").remove(),$(".modal-header-text,.modal-footer-text").remove(),addButtons(e,a,r,t)}),"next"):($(".close").after('<button type="button" class="btn btn-default btn-next" style="float: right;margin-right: 5px;">Next Page</button><button type="button" class="btn btn-default btn-prev" style="float: right;margin-right: 5px;">Prev Page</button>'),$(".modal-footer").prepend('<button type="button" class="btn btn-default btn-prev">Prev Page</button><button type="button" class="btn btn-default btn-next">Next Page</button>'),$(".modal-header .btn-prev").after('<span class="modal-header-text" style="float: right;margin-right: 8px;margin-top: 8px;">Page '+(e-1)+" of "+(a-1)+"</span>"),$(".modal-footer .btn-prev").before('<span class="modal-footer-text" style="margin-right: 8px;margin-top: 8px;">Page '+(e-1)+" of "+(a-1)+"</span>"),$(".btn-prev").on("click",function(){console.log("activate prev button only"),e--,t.find("#modal-img").attr("src",$(r).find("li").eq(e-1).find("a").attr("href")),$(".btn-prev,.btn-next").remove(),$(".modal-header-text,.modal-footer-text").remove(),addButtons(e,a,r,t)}),$(".btn-next").on("click",function(){console.log("activate next button only"),e++,t.find("#modal-img").attr("src",$(r).find("li").eq(e-1).find("a").attr("href")),$(".btn-prev,.btn-next").remove(),$(".modal-header-text,.modal-footer-text").remove(),addButtons(e,a,r,t)}),"next")};$("#myModal").on("show.bs.modal",function(e){var a=$(e.relatedTarget),r=a.data("title"),t=a.data("img");window.location.hash=a.data("href");var o=$(this);o.find(".modal-title").text(r),o.find("#modal-img").attr("src",t);var n=a.closest(".item"),i=n.find(".dropdown"),s=n.find(".dropdown-menu");o.find("#modal-dropdownfill").html(s.html());var l=$(i).find("li").length;l>2&&addButtons(2,l,i,o);var m=a.data("href");ga("send","event",{eventCategory:"product",eventAction:"click - preview",eventLabel:m,transport:"beacon"})}),$("#myModal").on("hidden.bs.modal",function(){$(".btn-prev,.btn-next").remove(),$(".modal-header-text,.modal-footer-text").remove()}),L.TopoJSON=L.GeoJSON.extend({addData:function(e){if("Topology"===e.type)for(key in e.objects)geojson=topojson.feature(e,e.objects[key]),L.GeoJSON.prototype.addData.call(this,geojson);else L.GeoJSON.prototype.addData.call(this,e)}}),jQuery(document).ready(function(e){window.location.href.split("/").pop()}),window.activeListingID="none",$("#home").click(function(){activeListingID="none1"}),window.selectedID="none",window.leftLayer=!0,window.map=L.map("map",{attributionControl:{collapsed:!0},maxBounds:[[-85,-180],[90,180]],maxBoundsViscosity:1,minZoom:3}).setView([20,0],3);var baseLayer=L.tileLayer("https://api.mapbox.com/styles/v1/hiu/cit0gm97500012ypfwnzijj6o/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaGl1IiwiYSI6InJWNGZJSzgifQ.xK1ndT3W8XL9lwVZrT6jvQ",{minZoom:1,maxZoom:5,scrollWheelZoom:!0,zoomControl:!1,attribution:"Names and boundary representation are not necessarily authoritative"}).addTo(map);map.zoomControl.setPosition("topright"),window.topoLayer,window.topoData,window.globalTopoData,addTopoData(),map.createPane("labels"),map.getPane("labels").style.zIndex=550,map.getPane("labels").style.pointerEvents="none",map.createPane("regions"),map.getPane("regions").style.zIndex=500;var geojsonMarkerOptions={radius:2,fillColor:"#ff7800",weight:2,opacity:0,fillOpacity:0},leadersStyle={color:"rgb(158,157,159)",weight:2,opacity:.8},RegionLabelsLayer=new L.GeoJSON.AJAX("assets/region_labels.geojson",{pointToLayer:function(e,a){return L.circleMarker(a,geojsonMarkerOptions)},onEachFeature:onEachFeatureRegions}).addTo(map),LargeCountryLabelsLayer=new L.GeoJSON.AJAX("assets/country_labels_large.geojson",{pointToLayer:function(e,a){return L.circleMarker(a,geojsonMarkerOptions)},onEachFeature:onEachFeatureLargeLabels}),MediumCountryLabelsLayer=new L.GeoJSON.AJAX("assets/country_labels_medium.geojson",{pointToLayer:function(e,a){return L.circleMarker(a,geojsonMarkerOptions)},onEachFeature:onEachFeatureMediumLabels}),SmallCountryLabelsLayer=new L.GeoJSON.AJAX("assets/country_labels_small.geojson",{pointToLayer:function(e,a){return L.circleMarker(a,geojsonMarkerOptions)},onEachFeature:onEachFeatureSmallLabels}),LeadersLabelsLayer=new L.GeoJSON.AJAX("assets/leaders.geojson",{style:leadersStyle}),regionCountryLabelFontSize=15,largeCountryLabelFontSize=13,mediumCountryLabelFontSize=9,smallCountryLabelFontSize=9;map.on("zoomend",function(){var e=regionCountryLabelFontSize+2*map.getZoom(),a=largeCountryLabelFontSize+map.getZoom(),r=mediumCountryLabelFontSize+map.getZoom(),t=smallCountryLabelFontSize+map.getZoom();$(".my-region-label").css("font-size",e+"px"),$(".my-large-country-label").css("font-size",a+"px"),$(".my-medium-country-label").css("font-size",r+"px"),$(".my-small-country-label").css("font-size",t+"px"),$(".my-small-country-italics-label").css("font-size",t+"px"),map.getZoom()<4&&(map.removeLayer(RegionLabelsLayer),$(".my-region-label").css("font-size","18px"),RegionLabelsLayer.addTo(map),map.hasLayer(LargeCountryLabelsLayer)&&map.removeLayer(LargeCountryLabelsLayer)),map.getZoom()>=4&&(map.hasLayer(LargeCountryLabelsLayer)||LargeCountryLabelsLayer.addTo(map)),map.getZoom()<5&&(map.removeLayer(MediumCountryLabelsLayer),map.removeLayer(SmallCountryLabelsLayer),map.removeLayer(LeadersLabelsLayer),$(".my-region-label").css("color","rgb(158,157,158)"),$(".my-large-country-label").css("color","rgb(158,157,158)"),$(".my-medium-country-label").css("color","rgb(158,157,158)"),$(".my-medium-country-italics-label").css("color","rgb(158,157,158)"),$(".my-small-country-label").css("color","rgb(158,157,158)"),$(".my-small-country-italics-label").css("color","rgb(158,157,158)")),map.getZoom()>=5&&(map.hasLayer(MediumCountryLabelsLayer)||(MediumCountryLabelsLayer.addTo(map),SmallCountryLabelsLayer.addTo(map),LeadersLabelsLayer.addTo(map),$(".my-region-label").css("color","rgb(145,144,146)"),$(".my-large-country-label").css("color","rgb(145,144,146)"),$(".my-medium-country-label").css("color","rgb(145,144,146)"),$(".my-medium-country-italics-label").css("color","rgb(145,144,146)"),$(".my-small-country-label").css("color","rgb(145,144,146)"),$(".my-small-country-italics-label").css("color","rgb(145,144,146)")))}),window.sidebar=new leafletSidebar("sidebar"),map.addControl(sidebar),window.newProducts=new L.markerClusterGroup({disableClusteringAtZoom:4,iconCreateFunction:function(e){var a=e.getChildCount(),r=" marker-cluster-";return r+=a<10?"small-orange":a<100?"medium-orange":"large-orange",new L.DivIcon({html:"<div><span>"+a+"</span></div>",className:"marker-cluster"+r,iconSize:new L.Point(40,40)})}}),window.AFmarkers=new L.MarkerClusterGroup,window.EAPmarkers=new L.MarkerClusterGroup,window.EURmarkers=new L.MarkerClusterGroup,window.NEAmarkers=new L.MarkerClusterGroup({maxClusterRadius:80}),window.SCAmarkers=new L.MarkerClusterGroup({maxClusterRadius:80}),window.WHAmarkers=new L.MarkerClusterGroup,window.markers2=new L.MarkerClusterGroup,window.AFcount=1,window.EAPcount=1,window.EURcount=1,window.NEAcount=1,window.SCAcount=1,window.WHAcount=1,window.layerClicked=!1,window.activeLayer="none",window.firstClick=!0,map.on("click",function(e){map.removeLayer(LargeCountryLabelsLayer),map.removeLayer(MediumCountryLabelsLayer),map.removeLayer(SmallCountryLabelsLayer),map.removeLayer(LeadersLabelsLayer),map.closePopup(),map.flyTo([20,0],3),layerClicked!==!0&&($(".sidebar").removeClass("sidebar-tall"),activeLayer="none",sidebar.open("home")),layerClicked=!1,$(".product").remove(),map.removeLayer(AFmarkers),map.removeLayer(EAPmarkers),map.removeLayer(EURmarkers),map.removeLayer(NEAmarkers),map.removeLayer(SCAmarkers),map.removeLayer(WHAmarkers),map.addLayer(newProducts),$(".hiu-tab").show()}),window.productIcon=L.divIcon({className:"product-icon",html:'<div class="circleBase type1"></div>'}),window.productIconNew=L.divIcon({className:"product-icon",html:'<div class="circleBase type-new"></div>'}),$('a[role="tab"]').click(function(){clickTab($(this).attr("id"))}),$(document).ready(function(){goToProduct(),function(){return $.getJSON("products/products.json")}().done(function(e){function a(e,a){if(e.properties&&e.properties.title){var r='<a onClick="goToProduct(this)" href="#'+e.properties.region_id+","+e.properties.product_id+'" class="title">'+e.properties.title+"</a>",t={keepInView:!0,maxWidth:200};a.bindPopup(r,t),a.setIcon(productIconNew),newProducts.addLayer(a)}}var r=(e.length,new Date),t=(r.getDate(),r.setDate(r.getDate()-60)),o=0,n=[];features=e.features;for(var i in features){if(new Date(features[i].properties.date_published)>t){o++;var s=features[i].properties.region_id;$("#"+s+" .new-product").length<=0&&$("#"+s).append("<div class='new-product'>new</div>"),n.push(features[i])}}L.geoJSON(n,{onEachFeature:a}),map.getZoom()<4&&map.addLayer(newProducts)})});